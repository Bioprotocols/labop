@prefix : <http://bioprotocols.org/paml#> .
@prefix opil: <http://bioprotocols.org/opil/v1#> .
@prefix om: <http://www.ontology-of-units-of-measure.org/resource/om-2/> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix xml: <http://www.w3.org/XML/1998/namespace> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix paml: <http://bioprotocols.org/paml#> .
@prefix prov: <http://www.w3.org/ns/prov#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix sbol: <http://sbols.org/v3#> .
@prefix uml: <http://bioprotocols.org/uml#> .
@prefix MathM: <http://www.w3.org/1998/Math/MathML> .
@prefix prov: <http://www.w3.org/ns/prov#> .
@base <http://bioprotocols.org/paml#> .

<http://bioprotocols.org/paml> rdf:type owl:Ontology ;
                              owl:imports uml:, sbol: , om:, prov:;
                              rdfs:comment "Protocol Activity Modeling Languge (PAML) ontology." ;
                              owl:versionInfo "0.3" .

#################################################################
#    Annotation properties
#################################################################

###  http://www.w3.org/2002/07/owl#maxCardinality
owl:maxCardinality rdf:type owl:AnnotationProperty .
owl:minCardinality rdf:type owl:AnnotationProperty .


#################################################################
#    Datatypes
#################################################################

###  http://www.w3.org/2001/XMLSchema#anySimpleType
xsd:anySimpleType rdf:type rdfs:Datatype .


#################################################################
#    Protocol definitions, based on UML
#################################################################

paml:Protocol rdf:type owl:Class ;
              rdfs:comment "A protocol is an activity in the laboratory" ;
        rdfs:subClassOf uml:Activity .


paml:Primitive rdf:type owl:Class ;
              rdfs:comment "A behavior that is a base-level library function" ;
        rdfs:subClassOf uml:Behavior .


#################################################################
#    Execution record, bootstrapping from PROV-O
#################################################################

paml:BehaviorExecution rdf:type owl:Class ;
        rdfs:comment "Record of the operation of a UML Behavior, real or simulated" ;
        rdfs:subClassOf prov:Activity , # note: prov:Activity here refers to the adapted version in SBOL
    [ rdf:type owl:Restriction ; owl:allValuesFrom paml:ParameterValue ; owl:onProperty paml:parameterValuePair ] ,
    [ rdf:type owl:Restriction ; owl:allValuesFrom xsd:boolean ; owl:onProperty paml:completedNormally ;
      owl:minCardinality "1"^^xsd:nonNegativeInteger ; owl:maxCardinality "1"^^xsd:nonNegativeInteger] ,
    [ rdf:type owl:Restriction ; owl:allValuesFrom paml:Material ; owl:onProperty paml:consumedMaterial ] .

paml:parameterValuePair rdf:type owl:ObjectProperty ;
              rdfs:subPropertyOf opil:compositionalProperty ;
              rdfs:domain paml:BehaviorExecution ;
              rdfs:range paml:ParameterValue ;
              rdfs:label "parameter_values" .

paml:completedNormally rdf:type owl:DatatypeProperty ;
              rdfs:domain paml:BehaviorExecution ;
              rdfs:range xsd:boolean ;
              rdfs:label "completed_normally" .

paml:consumedMaterial rdf:type owl:ObjectProperty ;
              rdfs:subPropertyOf opil:compositionalProperty ;
              rdfs:domain paml:BehaviorExecution ;
              rdfs:range paml:Material ;
              rdfs:label "consumed_material" .

paml:ParameterValue rdf:type owl:Class ;
        rdfs:comment "A value assigned to a parameter; similar to a prov:Usage, but embedding a literal value" ;
        rdfs:subClassOf sbol:Identified,
    [ rdf:type owl:Restriction ; owl:allValuesFrom uml:Parameter ; owl:onProperty paml:parameter ;
      owl:minCardinality "1"^^xsd:nonNegativeInteger ; owl:maxCardinality "1"^^xsd:nonNegativeInteger ] ,
    [ rdf:type owl:Restriction ; owl:allValuesFrom uml:LiteralSpecification ; owl:onProperty paml:parameterValue ;
      owl:minCardinality "1"^^xsd:nonNegativeInteger ; owl:maxCardinality "1"^^xsd:nonNegativeInteger ] .

paml:parameter rdf:type owl:ObjectProperty ;
              rdfs:domain paml:ParameterValue ;
              rdfs:range uml:Parameter ;
              rdfs:label "parameter" .

paml:parameterValue rdf:type owl:ObjectProperty ;
              rdfs:subPropertyOf opil:compositionalProperty ;
              rdfs:domain paml:ParameterValue ;
              rdfs:range uml:LiteralSpecification ;
              rdfs:label "value" .


paml:Material rdf:type owl:Class ;
        rdfs:comment "A consumable unit of material allocated for a BehaviorExecution (e.g., a microplate or reagent)" ;
        rdfs:subClassOf sbol:Identified,
    [ rdf:type owl:Restriction ; owl:allValuesFrom sbol:TopLevel ; owl:onProperty paml:specification ;
      owl:minCardinality "1"^^xsd:nonNegativeInteger ; owl:maxCardinality "1"^^xsd:nonNegativeInteger ] ,
    [ rdf:type owl:Restriction ; owl:allValuesFrom om:Measure ; owl:onProperty paml:amount ;
      owl:minCardinality "1"^^xsd:nonNegativeInteger ; owl:maxCardinality "1"^^xsd:nonNegativeInteger ] .

paml:specification rdf:type owl:ObjectProperty ;
              rdfs:domain paml:Material ;
              rdfs:range sbol:TopLevel ;
              rdfs:label "specification" .

paml:amount rdf:type owl:ObjectProperty ;
              rdfs:subPropertyOf opil:compositionalProperty ;
              rdfs:domain paml:Material ;
              rdfs:range om:Measure ;
              rdfs:label "amount" .

paml:ProtocolExecution rdf:type owl:Class ;
        rdfs:comment "Record of the operation of a Protocol, real or simulated" ;
        rdfs:subClassOf paml:BehaviorExecution ,
    [ rdf:type owl:Restriction ; owl:allValuesFrom paml:Protocol ; owl:onProperty paml:protocol ;
      owl:minCardinality "1"^^xsd:nonNegativeInteger ; owl:maxCardinality "1"^^xsd:nonNegativeInteger ] ,
    [ rdf:type owl:Restriction ; owl:allValuesFrom paml:ActivityNodeExecution ; owl:onProperty paml:execution ] ,
    [ rdf:type owl:Restriction ; owl:allValuesFrom paml:ActivityEdgeFlow ; owl:onProperty paml:flow ] .

paml:protocol rdf:type owl:ObjectProperty ;
              rdfs:domain paml:ProtocolExecution ;
              rdfs:range paml:Protocol ;
              rdfs:label "protocol" .

paml:execution rdf:type owl:ObjectProperty ;
              rdfs:subPropertyOf opil:compositionalProperty ;
              rdfs:domain paml:ProtocolExecution ;
              rdfs:range paml:ActivityNodeExecution ;
              rdfs:label "executions" .

paml:flow rdf:type owl:ObjectProperty ;
              rdfs:subPropertyOf opil:compositionalProperty ;
              rdfs:domain paml:ProtocolExecution ;
              rdfs:range paml:ActivityEdgeFlow ;
              rdfs:label "flows" .


paml:ActivityEdgeFlow rdf:type owl:Class ;
        rdfs:comment "Record of a token flowing through an ActivityEdge" ;
        rdfs:subClassOf sbol:Identified ,
    [ rdf:type owl:Restriction ; owl:allValuesFrom uml:ActivityEdge ; owl:onProperty paml:edge ;
      owl:minCardinality "0"^^xsd:nonNegativeInteger ; owl:maxCardinality "1"^^xsd:nonNegativeInteger ; ] ,
    [ rdf:type owl:Restriction ; owl:allValuesFrom sbol:Identified ; owl:onProperty paml:edgeValue ;
      owl:minCardinality "1"^^xsd:nonNegativeInteger ; owl:maxCardinality "1"^^xsd:nonNegativeInteger ; ] ,
    [ rdf:type owl:Restriction ; owl:allValuesFrom paml:ActivityNodeExecution ; owl:onProperty paml:tokenSource ;
      owl:minCardinality "1"^^xsd:nonNegativeInteger ; owl:maxCardinality "1"^^xsd:nonNegativeInteger ; ] .

paml:edge rdf:type owl:ObjectProperty ;
              rdfs:domain paml:ActivityEdgeFlow ;
              rdfs:range uml:ActivityEdge ;
              rdfs:label "edge" .

paml:edgeValue rdf:type owl:ObjectProperty ;
              rdfs:subPropertyOf opil:compositionalProperty ;
              rdfs:domain paml:ActivityEdgeFlow ;
              rdfs:range uml:LiteralSpecification ;
              rdfs:label "value" .

paml:tokenSource rdf:type owl:ObjectProperty ;
              rdfs:domain paml:ActivityEdgeFlow ;
              rdfs:range paml:ActivityNodeExecution ;
              rdfs:label "token_source" .


paml:ActivityNodeExecution rdf:type owl:Class ;
        rdfs:comment "Record of an execution of an ActivityNode" ;
        rdfs:subClassOf sbol:Identified ,
    [ rdf:type owl:Restriction ; owl:allValuesFrom uml:ActivityNode ; owl:onProperty paml:node ;
      owl:minCardinality "1"^^xsd:nonNegativeInteger ; owl:maxCardinality "1"^^xsd:nonNegativeInteger ; ] ,
    [ rdf:type owl:Restriction ; owl:allValuesFrom paml:ActivityEdgeFlow ; owl:onProperty paml:incomingFlow ] .

paml:node rdf:type owl:ObjectProperty ;
              rdfs:domain paml:ActivityNodeExecution ;
              rdfs:range uml:ActivityNode ;
              rdfs:label "node" .

paml:incomingFlow rdf:type owl:ObjectProperty ;
              rdfs:domain paml:ActivityNodeExecution ;
              rdfs:range paml:ActivityEdgeFlow ;
              rdfs:label "incoming_flows" .


paml:CallBehaviorExecution rdf:type owl:Class ;
        rdfs:comment "Record of an execution of an CallBehaviorAction" ;
        rdfs:subClassOf paml:ActivityNodeExecution ,
    [ rdf:type owl:Restriction ; owl:allValuesFrom paml:BehaviorExecution ; owl:onProperty paml:call ;
      owl:minCardinality "1"^^xsd:nonNegativeInteger ; owl:maxCardinality "1"^^xsd:nonNegativeInteger ; ] .

paml:call rdf:type owl:ObjectProperty ;
              rdfs:domain paml:CallBehaviorExecution ;
              rdfs:range paml:BehaviorExecution ;
              rdfs:label "call" .



#################################################################
#    Sample collection data model
#################################################################

paml:SampleCollection rdf:type owl:Class ;
        rdfs:comment "A sample collection is a group of samples" ;
        rdfs:subClassOf sbol:Identified .


paml:SampleArray rdf:type owl:Class ;
        rdfs:comment "A sample array is an n-dimensional rectangular group of samples, either with specified contents or empty, all stored in the same type of container" ;
        rdfs:subClassOf paml:SampleCollection ,
            [ rdf:type owl:Restriction ;
              owl:onProperty paml:containerType ;
              owl:allValuesFrom xsd:anyURI ; # replace with container ontology, when available
              owl:minCardinality "1"^^xsd:nonNegativeInteger ; owl:maxCardinality "1"^^xsd:nonNegativeInteger ;
              rdfs:comment "Type of container used for storing the samples. The size and dimension may not match that of the array: it is up to execution to lay out the array in one or more containers"
            ] ,
            [ rdf:type owl:Restriction ;
              owl:onProperty paml:contents ;
              owl:allValuesFrom xsd:string ; # need to replace this with an serializable array model
              owl:minCardinality "1"^^xsd:nonNegativeInteger ; owl:maxCardinality "1"^^xsd:nonNegativeInteger ;
              rdfs:comment "N-dimensional array of URI for specification or nulls"
            ] .

paml:containerType rdf:type owl:DatatypeProperty ;
              rdfs:domain paml:SampleArray ;
              rdfs:range xsd:anyURI ;
              rdfs:label "container_type" .

paml:contents rdf:type owl:DatatypeProperty ;
              rdfs:domain paml:SampleArray ;
              rdfs:range xsd:string ;
              rdfs:label "contents" .

paml:SampleMask rdf:type owl:Class ;
        rdfs:comment "A sample mask is a subset of a SampleCollection, as defined by an array of boolean indiating whether each contents value is included or not" ;
        rdfs:subClassOf paml:SampleCollection ,
            [ rdf:type owl:Restriction ;
              owl:onProperty paml:source ;
              owl:allValuesFrom paml:SampleCollection ;
              owl:minCardinality "1"^^xsd:nonNegativeInteger ; owl:maxCardinality "1"^^xsd:nonNegativeInteger ;
              rdfs:comment "Collection being subsetted via mask"
            ] ,
            [ rdf:type owl:Restriction ;
              owl:onProperty paml:mask ;
              owl:allValuesFrom xsd:string ; # need to replace this with an serializable array model
              owl:minCardinality "1"^^xsd:nonNegativeInteger ; owl:maxCardinality "1"^^xsd:nonNegativeInteger ;
              rdfs:comment "N-dimensional array of booleans indicating whether contents are included in mask or not"
            ] .

paml:source rdf:type owl:ObjectProperty ;
              rdfs:domain paml:SampleMask ;
              rdfs:range paml:SampleCollection ;
              rdfs:label "source" .

paml:mask rdf:type owl:DatatypeProperty ;
              rdfs:domain paml:mask ;
              rdfs:range xsd:string ;
              rdfs:label "mask" .




paml:SampleData rdf:type owl:Class ;
              rdfs:comment "Collection of samples with data at locations" ;
            rdfs:subClassOf sbol:Identified ,
                            [ rdf:type owl:Restriction ;
                              owl:onProperty paml:sampleDataValues ;
                              owl:allValuesFrom xsd:string ; # need to replace this with an serializable array model
                              owl:minCardinality "1"^^xsd:nonNegativeInteger ;
                              owl:maxCardinality "1"^^xsd:nonNegativeInteger ;
                              ] ,
                            [ rdf:type owl:Restriction ;
                              owl:onProperty paml:fromSamples ;
                              owl:allValuesFrom paml:SampleCollection ;
                              owl:minCardinality "1"^^xsd:nonNegativeInteger ;
                              owl:maxCardinality "1"^^xsd:nonNegativeInteger ;
                              ] .

paml:sampleDataValues rdf:type owl:ObjectProperty ;
              rdfs:domain paml:SampleData ;
              rdfs:range xsd:string ; # TODO: consider https://github.com/SynBioDex/sbol_factory/issues/7
              rdfs:label "values" .

paml:fromSamples rdf:type owl:ObjectProperty ;
              rdfs:subPropertyOf opil:compositionalProperty ;
              rdfs:domain paml:SampleData ;
              rdfs:range paml:SampleCollection ;
              rdfs:label "from_samples" .


#################################################################
#    Container specification
#################################################################
paml:queryString a owl:DatatypeProperty ,
                   owl:FunctionalProperty ;
    rdfs:domain paml:ContainerSpec ;
    rdfs:range xsd:string ;
    rdfs:label "queryString" ;
    rdfs:comment "A query string, in OWL Mancheseter syntax, to be used to find matching containers in the ContainerSpec." .


paml:prefixMap a owl:DatatypeProperty ,
                 owl:FunctionalProperty ;
    rdfs:domain paml:ContainerSpec ;
    rdfs:range xsd:string ;
    rdfs:label "prefixMap" ;
    rdfs:comment "A prefix map in JSON-LD format, to be applied to a queryString." .
    

paml:ContainerSpec a owl:Class ;
    rdfs:subClassOf sbol:Identified ,
    [ owl:intersectionOf ( [ rdf:type owl:Restriction ;
                             owl:onProperty paml:queryString ;
                             owl:maxCardinality "1"^^xsd:nonNegativeInteger ] 
                           [ rdf:type owl:Restriction ;
                             owl:onProperty paml:queryString ;
                             owl:minCardinality "1"^^xsd:nonNegativeInteger ]
                          ) ] ,
    [ owl:intersectionOf ( [ rdf:type owl:Restriction ;
                             owl:onProperty paml:prefixMap ;
                             owl:maxCardinality "1"^^xsd:nonNegativeInteger ] 
                           [ rdf:type owl:Restriction ;
                             owl:onProperty paml:prefixMap ;
                             owl:minCardinality "1"^^xsd:nonNegativeInteger ]
                          ) ] .
